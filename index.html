<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Loja Virtual</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden; 
        }
        .main-content-area {
             min-height: calc(100vh - 8rem); 
        }
        .main-content-section {
            min-height: calc(100vh - 8rem);
        }
        .product-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .feedback-message {
            padding: 0.75rem;
            margin-bottom: 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }
        .feedback-success {
            background-color: #D1FAE5;
            color: #065F46;
            border: 1px solid #6EE7B7;
        }
        .feedback-error {
            background-color: #FEE2E2;
            color: #991B1B;
            border: 1px solid #FCA5A5;
        }
        .drop-zone {
            border: 2px dashed #cbd5e1;
            border-radius: 0.375rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            background-color: #f9fafb;
        }
        .drop-zone.dragover {
            background-color: #eff6ff;
            border-color: #93c5fd;
        }
        .product-image-preview {
            max-width: 100px;
            max-height: 100px;
            object-fit: cover;
            border-radius: 0.25rem;
            margin-top: 0.5rem;
        }
        .top-bar-link {
            @apply text-xs text-gray-600 hover:text-blue-600 transition-colors duration-200 flex items-center;
        }
        .top-bar-icon {
            @apply w-4 h-4 mr-1;
        }
        #side-menu {
            transition: transform 0.3s ease-in-out;
        }
        #side-menu.open {
            transform: translateX(0);
        }
        #side-menu-overlay {
            transition: opacity 0.3s ease-in-out;
        }
         .product-detail-image {
            max-height: 400px; 
            object-fit: contain; 
        }
        .add-to-cart-feedback {
            transition: opacity 0.3s ease-in-out;
        }
        .pix-qr-code {
            width: 200px; 
            height: 200px; 
            border: 1px solid #e5e7eb; 
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="side-menu-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>

    <aside id="side-menu" class="fixed top-0 left-0 w-72 h-full bg-white shadow-xl z-50 transform -translate-x-full p-6 overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-semibold text-gray-700">Menu</h2>
            <button id="close-menu-button" class="text-gray-600 hover:text-gray-800">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        
        <div id="login-section-menu">
            <h3 class="text-lg font-medium text-gray-700 mb-3 border-b pb-2">Acesso Restrito</h3>
            <div id="login-feedback-menu" class="hidden"></div>
            <form id="login-form-menu">
                <div class="mb-3">
                    <label for="email-menu" class="block text-sm font-medium text-gray-600 mb-1">Email Admin</label>
                    <input type="email" id="email-menu" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="admin@email.com" required>
                </div>
                <div class="mb-3">
                    <label for="senha-menu" class="block text-sm font-medium text-gray-600 mb-1">Senha</label>
                    <input type="password" id="senha-menu" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="********" required>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300 text-sm">Entrar</button>
            </form>
        </div>

        <div id="admin-info-section-menu" class="hidden mt-4">
             <p class="text-sm text-gray-600 mb-2">Logado como: <span id="admin-email-display-menu" class="font-medium"></span></p>
             <button id="admin-logout-button-menu" class="w-full bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 transition duration-300 text-sm">Logout Admin</button>
        </div>
        
        <div class="mt-6 pt-4 border-t">
            <h3 class="text-lg font-medium text-gray-700 mb-3">Cliente</h3>
            <a href="#" id="register-client-link" class="block text-sm text-blue-600 hover:underline mb-2">Criar minha conta</a>
            <a href="#" id="login-client-link" class="block text-sm text-blue-600 hover:underline">Fazer Login (Cliente)</a>
        </div>

        <div class="mt-6 pt-4 border-t">
            <h3 class="text-lg font-medium text-gray-700 mb-3">Meus Pedidos</h3>
            <nav class="space-y-1">
                <a href="#" class="block text-sm text-gray-600 hover:bg-gray-100 p-2 rounded-md" data-order-status="open">Em Aberto / Aguardando Pagamento</a>
                <a href="#" class="block text-sm text-gray-600 hover:bg-gray-100 p-2 rounded-md" data-order-status="paid">Pagos</a>
                <a href="#" class="block text-sm text-gray-600 hover:bg-gray-100 p-2 rounded-md" data-order-status="completed">Concluídos / Recebidos</a>
            </nav>
        </div>
    </aside>

    <div class="bg-gray-200 py-2 border-b border-gray-300">
        <div class="container mx-auto px-6 flex flex-wrap justify-end items-center text-sm">
            <div class="flex items-center space-x-4">
                <a href="#" id="contact-us-link" class="top-bar-link">
                    <svg class="top-bar-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                    Fale Conosco (SAC)
                </a>
            </div>
        </div>
    </div>

    <header class="bg-white shadow-md sticky top-0 z-30"> 
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <button id="open-menu-button" class="text-gray-600 hover:text-blue-600 lg:hidden"> 
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
            <a href="#" id="store-logo" class="text-base font-bold text-blue-600" onclick="showStoreView()">LogoLoja</a>
            <nav id="store-nav" class="hidden lg:flex items-center"> 
                <a href="#" class="px-4 text-gray-600 hover:text-blue-500" onclick="showStoreView()">Início</a>
                <a href="https://wa.me/5511914505059" target="_blank" class="px-4 text-gray-600 hover:text-blue-500 flex items-center">
                    <svg class="w-4 h-4 mr-1" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91C2.13 13.66 2.59 15.33 3.42 16.79L2.05 22L7.31 20.62C8.75 21.38 10.36 21.82 12.04 21.82C17.5 21.82 21.95 17.37 21.95 11.91C21.95 6.45 17.5 2 12.04 2ZM12.04 20.13C10.56 20.13 9.15 19.74 7.96 19.03L7.62 18.83L4.39 19.69L5.29 16.52L5.07 16.17C4.32 14.91 3.82 13.46 3.82 11.91C3.82 7.39 7.52 3.69 12.04 3.69C16.56 3.69 20.26 7.39 20.26 11.91C20.26 16.43 16.56 20.13 12.04 20.13ZM17.46 14.47C17.24 14.36 16.05 13.79 15.86 13.73C15.67 13.66 15.53 13.62 15.38 13.84C15.24 14.06 14.81 14.59 14.67 14.73C14.53 14.87 14.39 14.91 14.17 14.8C13.94 14.69 13.01 14.35 11.92 13.38C11.07 12.61 10.53 11.7 10.36 11.41C10.18 11.12 10.31 11 10.43 10.88C10.54 10.77 10.67 10.59 10.81 10.43C10.96 10.27 11 10.16 11.07 10.02C11.14 9.88 11.09 9.74 11.04 9.63C10.98 9.52 10.55 8.46 10.38 8.06C10.21 7.66 10.03 7.71 9.89 7.7C9.77 7.7 9.61 7.7 9.46 7.7C9.31 7.7 9.06 7.77 8.84 7.99C8.62 8.21 8.05 8.74 8.05 9.88C8.05 11.02 8.88 12.1 9.02 12.24C9.16 12.38 10.55 14.52 12.68 15.43C13.64 15.84 14.3 16.08 14.79 16.26C15.51 16.52 15.99 16.49 16.35 16.43C16.75 16.36 17.64 15.79 17.83 15.29C18.02 14.8 18.02 14.39 17.97 14.29C17.92 14.18 17.68 14.07 17.46 14.47Z"></path></svg>
                    WhatsApp
                </a>
                </nav>
            <div class="lg:hidden w-6"></div> </div>
    </header>

    <div class="main-content-area container mx-auto mt-4 gap-4 px-2 md:px-0">
        <div id="dynamic-content-area" class="w-full">
            
            <div id="store-view" class="flex flex-col lg:flex-row gap-4">
                <main id="main-product-list" class="w-full lg:w-3/4 bg-white p-6 rounded-lg shadow-lg main-content-section">
                    <h1 class="text-3xl font-bold mb-8 text-center text-gray-700">Nossos Produtos</h1>
                    <section class="mb-12">
                        <h2 class="text-2xl font-semibold mb-6 text-gray-600 border-b pb-2">Destaques da Semana</h2>
                        <div id="product-row-1" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                    </section>
                     <section class="mb-12">
                        <h2 class="text-2xl font-semibold mb-6 text-gray-600 border-b pb-2">Novidades</h2>
                        <div id="product-row-2" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                    </section>
                    <section>
                        <h2 class="text-2xl font-semibold mb-6 text-gray-600 border-b pb-2">Mais Vendidos</h2>
                        <div id="product-row-3" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                    </section>
                </main>
                <aside id="cart-sidebar" class="w-full lg:w-1/4 bg-white p-6 rounded-lg shadow-lg lg:sticky lg:top-20 main-content-section" style="max-height: calc(100vh - 10rem); overflow-y: auto;">
                    <h2 class="text-xl font-semibold mb-4 text-gray-700">Carrinho</h2>
                    <div id="cart-items-list"></div>
                    <div id="cart-total-section" class="mt-6 pt-4 border-t border-gray-300">
                        <div class="flex justify-between items-center font-semibold text-gray-700">
                            <span>Total:</span>
                            <span id="cart-total-value">R$ 0,00</span>
                        </div>
                        <button id="checkout-button-sidebar" class="w-full mt-4 bg-orange-500 text-white py-2 px-4 rounded-md hover:bg-orange-600 transition duration-300">Ir para Pagamento</button>
                    </div>
                    <div id="cart-empty-message" class="text-center text-gray-500 mt-6">Seu carrinho está vazio.</div>
                </aside>
            </div>

            <div id="product-detail-view" class="hidden bg-white p-6 md:p-8 rounded-lg shadow-lg main-content-section"></div>
            
            <div id="admin-panel" class="hidden w-full bg-white p-6 rounded-lg shadow-lg main-content-section">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-700">Painel do Administrador</h2>
                    <button id="back-to-store-button-admin" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md transition duration-300">
                        Ver Loja
                    </button>
                </div>
                <section id="product-management" class="mb-10">
                    <h3 class="text-2xl font-semibold mb-6 text-gray-600 border-b pb-3">Gerenciar Produtos</h3>
                    <form id="add-product-form" class="mb-8 p-6 border border-gray-200 rounded-lg bg-gray-50 shadow-sm">
                        <h4 class="text-xl font-medium mb-4 text-gray-700">Adicionar Novo Produto</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label for="product-name" class="block text-sm font-medium text-gray-600 mb-1">Nome</label>
                                <input type="text" id="product-name" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required>
                            </div>
                            <div>
                                <label for="product-price" class="block text-sm font-medium text-gray-600 mb-1">Preço (R$)</label>
                                <input type="number" step="0.01" id="product-price" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label for="product-image-url" class="block text-sm font-medium text-gray-600 mb-1">URL da Imagem</label>
                            <input type="url" id="product-image-url" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" placeholder="https://exemplo.com/imagem.jpg">
                             <div id="image-drop-zone" class="mt-2 drop-zone">
                                <p>Arraste e solte uma imagem aqui, ou clique para selecionar.</p>
                                <input type="file" id="product-image-file" class="hidden" accept="image/*">
                                <img id="image-preview" class="hidden product-image-preview" alt="Pré-visualização"/>
                            </div>
                        </div>
                        <div class="mb-6">
                            <label for="product-description" class="block text-sm font-medium text-gray-600 mb-1">Descrição</label>
                            <textarea id="product-description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"></textarea>
                        </div>
                        <button type="submit" class="w-full md:w-auto bg-green-600 text-white py-2 px-6 rounded-md hover:bg-green-700">Adicionar Produto</button>
                    </form>
                    <h4 class="text-xl font-medium mb-4 text-gray-700">Produtos Cadastrados</h4>
                    <div id="admin-product-list" class="space-y-4">
                        <p id="no-admin-products" class="text-gray-500">Nenhum produto.</p>
                    </div>
                </section>
                <section id="admin-user-management" class="mb-10">
                    <h3 class="text-2xl font-semibold mb-6 text-gray-600 border-b pb-3">Gerenciar Administradores</h3>
                    <form id="add-admin-form" class="mb-8 p-6 border border-gray-200 rounded-lg bg-gray-50 shadow-sm">
                        <h4 class="text-xl font-medium mb-4 text-gray-700">Adicionar Novo Admin</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label for="admin-new-email" class="block text-sm font-medium text-gray-600 mb-1">Email</label>
                                <input type="email" id="admin-new-email" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required>
                            </div>
                            <div>
                                <label for="admin-new-password" class="block text-sm font-medium text-gray-600 mb-1">Senha</label>
                                <input type="password" id="admin-new-password" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required>
                            </div>
                        </div>
                        <button type="submit" class="w-full md:w-auto bg-blue-600 text-white py-2 px-6 rounded-md hover:bg-blue-700">Adicionar Admin</button>
                    </form>
                     <h4 class="text-xl font-medium mb-4 text-gray-700">Admins Cadastrados</h4>
                    <div id="admin-users-list" class="space-y-2"></div>
                </section>
            </div>

             <div id="orders-view" class="hidden bg-white p-6 md:p-8 rounded-lg shadow-lg main-content-section">
                <h2 class="text-3xl font-bold mb-8 text-center text-gray-700">Meus Pedidos</h2>
                <p id="orders-status-message" class="text-center text-gray-600">Selecione um status de pedido no menu lateral.</p>
            </div>
            
            <div id="cart-view-dedicated" class="hidden bg-white p-6 md:p-8 rounded-lg shadow-lg main-content-section">
                <div class="max-w-3xl mx-auto">
                    <div class="flex justify-between items-center mb-8">
                        <h2 class="text-3xl font-bold text-gray-800">Meu Carrinho</h2>
                        <button id="continue-shopping-from-cart-view" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md transition duration-300">
                            Continuar Comprando
                        </button>
                    </div>
                    <div id="cart-items-list-dedicated" class="space-y-4 mb-8">
                        </div>
                    <div id="cart-empty-message-dedicated" class="text-center text-gray-500 py-8 hidden">
                        <p class="text-xl mb-4">Seu carrinho está vazio.</p>
                        <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                    </div>
                    <div id="cart-summary-dedicated" class="mt-6 pt-6 border-t border-gray-200">
                        <div class="flex justify-between items-center text-xl font-semibold text-gray-700 mb-6">
                            <span>Total:</span>
                            <span id="cart-total-value-dedicated">R$ 0,00</span>
                        </div>
                        <button id="checkout-button-dedicated" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-md transition duration-300 text-lg">
                            Ir para Pagamento
                        </button>
                    </div>
                </div>
            </div>

            <div id="checkout-view" class="hidden bg-white p-6 md:p-8 rounded-lg shadow-lg main-content-section">
                <div class="max-w-2xl mx-auto">
                    <button id="back-to-cart-button" class="mb-6 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-md transition duration-300 inline-flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                        Voltar ao Carrinho
                    </button>
                    <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Pagamento</h2>
                    
                    <div id="checkout-summary" class="mb-8 p-4 border rounded-md bg-gray-50">
                        <h3 class="text-xl font-semibold text-gray-700 mb-3">Resumo do Pedido</h3>
                        <div id="checkout-items-list" class="text-sm text-gray-600 space-y-1"></div>
                        <div class="mt-3 pt-3 border-t flex justify-between font-bold text-gray-700">
                            <span>Total do Pedido:</span>
                            <span id="checkout-total-value">R$ 0,00</span>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200">
                        <h3 class="text-xl font-semibold text-blue-600 mb-6 text-center">Pagar com Pix</h3>
                        <div class="flex flex-col items-center gap-6">
                            <div>
                                <p class="text-center text-gray-600 mb-2">Escaneie o QR Code abaixo:</p>
                                <img id="pix-qr-code-img" src="https://placehold.co/200x200/000000/FFFFFF?text=QR+Code+Pix" alt="QR Code Pix" class="pix-qr-code mx-auto rounded-md">
                            </div>
                            <div class="w-full max-w-md">
                                <p class="text-center text-gray-600 mb-2">Ou use a chave Pix (Copia e Cola):</p>
                                <div class="flex items-center border border-gray-300 rounded-md p-2 bg-gray-50">
                                    <input type="text" id="pix-key-text" class="flex-grow p-2 border-none bg-transparent focus:ring-0 text-sm text-gray-700" readonly>
                                    <button id="copy-pix-key-button" class="ml-2 bg-blue-500 hover:bg-blue-600 text-white text-xs font-semibold py-2 px-3 rounded-md transition duration-300">
                                        Copiar
                                    </button>
                                </div>
                                <p id="copy-feedback" class="text-xs text-green-600 mt-1 text-center hidden">Chave copiada!</p>
                            </div>
                            <button id="payment-confirmed-button" class="mt-6 w-full max-w-md bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-md transition duration-300 text-lg">
                                Já Fiz o Pagamento
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <footer class="bg-gray-800 text-white text-center p-6 mt-12">
        <p>&copy; 2024 Minha Loja Virtual. Todos os direitos reservados.</p>
    </footer>

    <script>
        // --- ELEMENTOS DO DOM ---
        const openMenuButton = document.getElementById('open-menu-button');
        const closeMenuButton = document.getElementById('close-menu-button');
        const sideMenu = document.getElementById('side-menu');
        const sideMenuOverlay = document.getElementById('side-menu-overlay');

        const loginFormMenu = document.getElementById('login-form-menu');
        const loginFeedbackMenu = document.getElementById('login-feedback-menu');
        const loginSectionMenu = document.getElementById('login-section-menu');
        const adminInfoSectionMenu = document.getElementById('admin-info-section-menu');
        const adminEmailDisplayMenu = document.getElementById('admin-email-display-menu');
        const adminLogoutButtonMenu = document.getElementById('admin-logout-button-menu');
        
        const dynamicContentArea = document.getElementById('dynamic-content-area');
        const storeView = document.getElementById('store-view');
        const adminPanel = document.getElementById('admin-panel');
        const productDetailView = document.getElementById('product-detail-view');
        const ordersView = document.getElementById('orders-view');
        const ordersStatusMessage = document.getElementById('orders-status-message');
        const checkoutView = document.getElementById('checkout-view');
        const cartViewDedicated = document.getElementById('cart-view-dedicated');


        const backToStoreButtonAdmin = document.getElementById('back-to-store-button-admin');

        const addProductForm = document.getElementById('add-product-form');
        const adminProductListContainer = document.getElementById('admin-product-list');
        const noAdminProductsMessage = document.getElementById('no-admin-products');
        const addAdminForm = document.getElementById('add-admin-form');
        const adminUsersListContainer = document.getElementById('admin-users-list');
        
        const imageDropZone = document.getElementById('image-drop-zone');
        const productImageFileInput = document.getElementById('product-image-file');
        const imagePreview = document.getElementById('image-preview');
        let uploadedImageFile = null; 

        // Checkout View Elements
        const backToCartButton = document.getElementById('back-to-cart-button');
        const pixKeyTextElement = document.getElementById('pix-key-text');
        const copyPixKeyButton = document.getElementById('copy-pix-key-button');
        const copyFeedbackElement = document.getElementById('copy-feedback');
        const paymentConfirmedButton = document.getElementById('payment-confirmed-button');
        const checkoutItemsList = document.getElementById('checkout-items-list');
        const checkoutTotalValue = document.getElementById('checkout-total-value');

        // Dedicated Cart View Elements
        const cartItemsListDedicated = document.getElementById('cart-items-list-dedicated');
        const cartTotalValueDedicated = document.getElementById('cart-total-value-dedicated');
        const cartEmptyMessageDedicated = document.getElementById('cart-empty-message-dedicated');
        const checkoutButtonDedicated = document.getElementById('checkout-button-dedicated');
        const continueShoppingFromCartViewButton = document.getElementById('continue-shopping-from-cart-view');
        const cartSummaryDedicated = document.getElementById('cart-summary-dedicated');



        // --- ESTADO DA APLICAÇÃO ---
        let products = [ 
            { id: 'prod1', name: "Produto Exemplo Alfa", price: 99.90, imageUrl: "https://placehold.co/400x300/E0E7FF/4F46E5?text=Produto+Alfa", description: "Descrição detalhada do Produto Exemplo Alfa. Este produto é feito com materiais de alta qualidade e oferece excelente durabilidade. Ideal para diversas aplicações e gostos." },
            { id: 'prod2', name: "Produto Exemplo Beta", price: 129.50, imageUrl: "https://placehold.co/400x300/DBEAFE/1D4ED8?text=Produto+Beta", description: "O Produto Exemplo Beta combina design moderno com funcionalidade superior. Perfeito para quem busca inovação e estilo. Aproveite esta oferta especial." },
            { id: 'prod3', name: "Produto Exemplo Gama", price: 75.00, imageUrl: "https://placehold.co/400x300/BFDBFE/1E40AF?text=Produto+Gama", description: "Conheça o Produto Exemplo Gama, uma solução prática e eficiente para o seu dia a dia. Com garantia estendida e suporte ao cliente." },
            { id: 'prod4', name: "Produto Exemplo Delta", price: 210.00, imageUrl: "https://placehold.co/400x300/93C5FD/1C3FAA?text=Produto+Delta", description: "Produto Exemplo Delta: robustez e tecnologia de ponta. Indicado para uso profissional e para os entusiastas mais exigentes." },
            { id: 'prod5', name: "Produto Exemplo Epsilon", price: 45.99, imageUrl: "https://placehold.co/400x300/60A5FA/1B3A9A?text=Produto+Epsilon", description: "Leve e compacto, o Produto Exemplo Epsilon é seu companheiro ideal para todas as horas. Fácil de transportar e usar." },
            { id: 'prod6', name: "Produto Exemplo Zeta", price: 88.80, imageUrl: "https://placehold.co/400x300/3B82F6/1A358A?text=Produto+Zeta", description: "O Produto Exemplo Zeta oferece um excelente custo-benefício sem abrir mão da qualidade. Satisfação garantida ou seu dinheiro de volta." }
        ];
        let adminUsers = [
            { email: "viniciusaraujomatos1@gmail.com", password: "Belohorizonte2020@" }
        ];
        let cart = [];
        let isAdminLoggedIn = false;
        let currentAdminEmail = null;
        let activeFeedbackTimeout = null; 

        // --- CONTROLE DO MENU LATERAL ---
        function openSideMenu() {
            sideMenu.classList.add('open');
            sideMenuOverlay.classList.remove('hidden');
            sideMenuOverlay.style.opacity = '1';
        }

        function closeSideMenu() {
            sideMenu.classList.remove('open');
            sideMenuOverlay.style.opacity = '0';
            setTimeout(() => {
                sideMenuOverlay.classList.add('hidden');
            }, 300); 
        }

        openMenuButton?.addEventListener('click', openSideMenu);
        closeMenuButton?.addEventListener('click', closeSideMenu);
        sideMenuOverlay?.addEventListener('click', closeSideMenu);

        // --- FUNÇÕES DE RENDERIZAÇÃO E CONTROLE DE VIEW ---
        function setActiveView(activeViewElement) {
            [storeView, adminPanel, productDetailView, ordersView, checkoutView, cartViewDedicated].forEach(view => { 
                view?.classList.add('hidden');
            });
            activeViewElement?.classList.remove('hidden');
        }
        
        function renderStoreProducts() {
            const productRow1 = document.getElementById('product-row-1');
            const productRow2 = document.getElementById('product-row-2');
            const productRow3 = document.getElementById('product-row-3'); 

            if (!productRow1 || !productRow2 || !productRow3) return;
            
            productRow1.innerHTML = ''; productRow2.innerHTML = ''; productRow3.innerHTML = '';

            products.forEach((product, index) => {
                const productCard = document.createElement('div');
                productCard.className = "product-card bg-gray-50 border border-gray-200 rounded-lg p-4 shadow-sm flex flex-col items-center text-center";
                productCard.dataset.id = product.id;
                productCard.innerHTML = `
                    <img src="${product.imageUrl || 'https://placehold.co/300x200/cccccc/969696?text=Sem+Imagem'}" alt="Imagem de ${product.name}" class="w-full h-48 object-cover rounded-md mb-4 product-image">
                    <h3 class="text-lg font-medium text-gray-700 mb-1 product-name">${product.name}</h3>
                    <p class="text-xl font-bold text-blue-600 mb-3 product-price">R$ ${product.price.toFixed(2)}</p>
                    <p class="text-xs text-gray-500 mb-2 product-description h-10 overflow-hidden" title="${product.description || ''}">${product.description.substring(0,50) + "..." || 'Sem descrição detalhada.'}</p>
                    <button class="mt-auto w-full bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600 transition duration-300 add-to-cart-button-list">Adicionar ao Carrinho</button>
                    <div class="add-to-cart-feedback hidden mt-2 text-sm w-full"></div>
                `;
                productCard.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('add-to-cart-button-list') && !e.target.closest('.add-to-cart-feedback')) { 
                         showProductDetailView(product.id);
                    }
                });
                
                if (index < 3) productRow1.appendChild(productCard);
                else if (index < 6) productRow2.appendChild(productCard);
                else productRow3.appendChild(productCard); 
            });
            addEventListenersToAddToCartButtons();
        }

        function showProductDetailView(productId) {
            const product = products.find(p => p.id === productId);
            if (!product || !productDetailView) return;

            productDetailView.innerHTML = `
                <button id="back-to-store-from-detail" class="mb-6 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-md transition duration-300 inline-flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                    Voltar para Loja
                </button>
                <div class="flex flex-col md:flex-row gap-8">
                    <div class="md:w-1/2">
                        <img src="${product.imageUrl || 'https://placehold.co/600x400/cccccc/969696?text=Sem+Imagem'}" alt="${product.name}" class="w-full rounded-lg shadow-lg product-detail-image">
                    </div>
                    <div class="md:w-1/2 flex flex-col">
                        <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-3">${product.name}</h1>
                        <p class="text-2xl font-semibold text-blue-600 mb-5">R$ ${product.price.toFixed(2)}</p>
                        <p class="text-gray-600 mb-6 leading-relaxed">${product.description}</p>
                        <button data-id="${product.id}" class="mt-auto w-full md:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-md transition duration-300 text-lg add-to-cart-button-detail">
                            Adicionar ao Carrinho
                        </button>
                        <div class="add-to-cart-feedback hidden mt-2 text-sm"></div>
                    </div>
                </div>
            `;
            setActiveView(productDetailView);
            document.getElementById('back-to-store-from-detail')?.addEventListener('click', showStoreView);
            
            const addToCartDetailButton = productDetailView.querySelector('.add-to-cart-button-detail');
            addToCartDetailButton?.addEventListener('click', function() {
                const prodId = this.dataset.id;
                const productToAdd = products.find(p => p.id === prodId);
                if (productToAdd) {
                    handleAddToCart(productToAdd, this); 
                }
            });
            closeSideMenu();
        }
        
        function showAdminView(adminEmail) {
            isAdminLoggedIn = true;
            currentAdminEmail = adminEmail;
            setActiveView(adminPanel);
            loginSectionMenu.classList.add('hidden');
            adminInfoSectionMenu.classList.remove('hidden');
            adminEmailDisplayMenu.textContent = adminEmail;
            document.getElementById('store-logo').textContent = "Painel Admin";
            document.getElementById('store-nav').classList.add('hidden');
            openMenuButton.classList.add('lg:hidden'); 
            renderAdminProducts();
            renderAdminUsers();
            closeSideMenu();
        }

        function showStoreView() {
            isAdminLoggedIn = false;
            currentAdminEmail = null;
            setActiveView(storeView);
            loginSectionMenu.classList.remove('hidden'); 
            adminInfoSectionMenu.classList.add('hidden'); 
            document.getElementById('store-logo').textContent = "LogoLoja";
            document.getElementById('store-nav').classList.remove('hidden'); 
            openMenuButton.classList.remove('lg:hidden'); 
            renderStoreProducts(); 
            closeSideMenu();
        }
        
        function showOrdersView(status) {
            setActiveView(ordersView);
            ordersStatusMessage.textContent = `Visualizando pedidos: ${status}. (Funcionalidade a ser implementada).`;
            closeSideMenu();
        }

        function showCheckoutView() {
            if (cart.length === 0) {
                // Em vez de alert, podemos redirecionar para a visualização de carrinho vazio
                showCartViewDedicated(); 
                return;
            }
            setActiveView(checkoutView);
            pixKeyTextElement.value = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
            checkoutItemsList.innerHTML = '';
            let total = 0;
            cart.forEach(item => {
                const listItem = document.createElement('div');
                listItem.className = 'flex justify-between';
                listItem.innerHTML = `<span>${item.name} (x${item.quantity})</span> <span>R$ ${(item.price * item.quantity).toFixed(2)}</span>`;
                checkoutItemsList.appendChild(listItem);
                total += item.price * item.quantity;
            });
            checkoutTotalValue.textContent = `R$ ${total.toFixed(2)}`;
            closeSideMenu();
        }

        function showCartViewDedicated() {
            setActiveView(cartViewDedicated);
            cartItemsListDedicated.innerHTML = '';
            let total = 0;

            if (cart.length === 0) {
                cartEmptyMessageDedicated.classList.remove('hidden');
                cartSummaryDedicated.classList.add('hidden'); // Esconde o sumário e botão de pagamento
            } else {
                cartEmptyMessageDedicated.classList.add('hidden');
                cartSummaryDedicated.classList.remove('hidden'); // Mostra o sumário e botão de pagamento
                cart.forEach((item) => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'flex justify-between items-center p-4 border-b border-gray-200';
                    itemElement.innerHTML = `
                        <div class="flex items-center">
                            <img src="${item.imageUrl || 'https://placehold.co/60x60/cccccc/969696?text=N/A'}" alt="${item.name}" class="w-16 h-16 object-cover rounded-md mr-4">
                            <div>
                                <h4 class="font-semibold text-gray-700">${item.name}</h4>
                                <p class="text-sm text-gray-500">Quantidade: ${item.quantity}</p>
                                <p class="text-sm text-blue-600">Preço: R$ ${item.price.toFixed(2)}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold text-gray-700">R$ ${(item.price * item.quantity).toFixed(2)}</p>
                            <button class="text-red-500 hover:text-red-700 text-xs mt-1 remove-from-cart-button-dedicated" data-id="${item.id}">Remover</button>
                        </div>
                    `;
                    cartItemsListDedicated.appendChild(itemElement);
                    total += item.price * item.quantity;
                });
            }
            cartTotalValueDedicated.textContent = `R$ ${total.toFixed(2)}`;
            addEventListenersToRemoveFromCartButtonsDedicated();
            closeSideMenu();
        }


        if (loginFormMenu) {
            loginFormMenu.addEventListener('submit', function(event) {
                event.preventDefault();
                const email = document.getElementById('email-menu').value;
                const password = document.getElementById('senha-menu').value;
                const admin = adminUsers.find(user => user.email === email && user.password === password);
                loginFeedbackMenu.innerHTML = '';
                loginFeedbackMenu.classList.remove('hidden', 'feedback-success', 'feedback-error');
                if (admin) {
                    loginFeedbackMenu.textContent = "Login bem-sucedido! Carregando painel...";
                    loginFeedbackMenu.classList.add('feedback-message', 'feedback-success');
                    setTimeout(() => {
                       showAdminView(admin.email);
                       loginFeedbackMenu.classList.add('hidden'); 
                    }, 500); 
                } else {
                    loginFeedbackMenu.textContent = "Email ou senha inválidos.";
                    loginFeedbackMenu.classList.add('feedback-message', 'feedback-error');
                }
            });
        }

        adminLogoutButtonMenu?.addEventListener('click', () => { showStoreView(); });
        backToStoreButtonAdmin?.addEventListener('click', showStoreView);
        backToCartButton?.addEventListener('click', showCartViewDedicated); // Alterado para ir para a nova tela de carrinho
        checkoutButtonDedicated?.addEventListener('click', showCheckoutView);
        continueShoppingFromCartViewButton?.addEventListener('click', showStoreView);


        if (addProductForm) {
            addProductForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const name = document.getElementById('product-name').value;
                const price = parseFloat(document.getElementById('product-price').value);
                let imageUrl = document.getElementById('product-image-url').value;
                const description = document.getElementById('product-description').value;
                if (uploadedImageFile) {
                    if (!imageUrl) imageUrl = URL.createObjectURL(uploadedImageFile);
                }
                if (name && price > 0) {
                    const newProduct = {
                        id: 'prod' + (products.length + 1) + Date.now(), 
                        name, price,
                        imageUrl: imageUrl || 'https://placehold.co/300x200/cccccc/969696?text=Nova+Imagem',
                        description
                    };
                    products.push(newProduct);
                    renderAdminProducts(); renderStoreProducts(); 
                    addProductForm.reset();
                    imagePreview.classList.add('hidden'); imagePreview.src = '';
                    uploadedImageFile = null;
                    document.getElementById('product-image-url').value = ''; 
                } else {
                    const feedback = document.createElement('p');
                    feedback.textContent = "Por favor, preencha nome e preço do produto.";
                    feedback.className = "text-red-500 text-sm mt-2 product-add-feedback";
                    addProductForm.querySelector('button[type="submit"]').insertAdjacentElement('afterend', feedback);
                    setTimeout(() => feedback.remove(), 3000);
                }
            });
        }

        function addEventListenersToRemoveProductButtons() {
            const removeButtons = adminProductListContainer.querySelectorAll('.remove-product-button');
            removeButtons.forEach(button => {
                const newButton = button.cloneNode(true);
                button.parentNode.replaceChild(newButton, button);
                newButton.addEventListener('click', function() {
                    const productId = this.dataset.id;
                    products = products.filter(p => p.id !== productId);
                    renderAdminProducts(); renderStoreProducts(); 
                });
            });
        }
        
        if (imageDropZone) {
            imageDropZone.addEventListener('click', () => productImageFileInput.click());
            imageDropZone.addEventListener('dragover', (event) => { event.preventDefault(); imageDropZone.classList.add('dragover'); });
            imageDropZone.addEventListener('dragleave', () => imageDropZone.classList.remove('dragover'));
            imageDropZone.addEventListener('drop', (event) => {
                event.preventDefault(); imageDropZone.classList.remove('dragover');
                const files = event.dataTransfer.files;
                if (files.length > 0) handleImageFile(files[0]);
            });
            productImageFileInput.addEventListener('change', (event) => {
                const files = event.target.files;
                if (files.length > 0) handleImageFile(files[0]);
            });
        }

        function handleImageFile(file) {
            const feedbackDiv = addProductForm.querySelector('.image-upload-feedback');
            if (feedbackDiv) feedbackDiv.remove(); 
            if (file && file.type.startsWith('image/')) {
                uploadedImageFile = file; 
                const reader = new FileReader();
                reader.onload = (e) => {
                    imagePreview.src = e.target.result;
                    imagePreview.classList.remove('hidden');
                    document.getElementById('product-image-url').value = ''; 
                }
                reader.readAsDataURL(file);
            } else {
                const feedback = document.createElement('p');
                feedback.textContent = "Por favor, selecione um arquivo de imagem válido.";
                feedback.className = "text-red-500 text-sm mt-1 image-upload-feedback"; 
                imageDropZone.parentNode.insertBefore(feedback, imageDropZone.nextSibling);
                uploadedImageFile = null; imagePreview.classList.add('hidden'); imagePreview.src = '';
            }
        }

        if (addAdminForm) {
            addAdminForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const email = document.getElementById('admin-new-email').value;
                const password = document.getElementById('admin-new-password').value;
                const feedbackDiv = addAdminForm.querySelector('.admin-add-feedback');
                if (feedbackDiv) feedbackDiv.remove();
                if (email && password) {
                    if (adminUsers.find(user => user.email === email)) {
                        const feedback = document.createElement('p');
                        feedback.textContent = "Este email de administrador já existe.";
                        feedback.className = "text-red-500 text-sm mt-2 admin-add-feedback";
                        addAdminForm.querySelector('button[type="submit"]').insertAdjacentElement('afterend', feedback);
                        setTimeout(() => feedback.remove(), 3000); return;
                    }
                    adminUsers.push({ email, password });
                    renderAdminUsers(); addAdminForm.reset();
                    const feedback = document.createElement('p');
                    feedback.textContent = "Administrador adicionado com sucesso!";
                    feedback.className = "text-green-500 text-sm mt-2 admin-add-feedback";
                    addAdminForm.querySelector('button[type="submit"]').insertAdjacentElement('afterend', feedback);
                    setTimeout(() => feedback.remove(), 3000);
                } else {
                    const feedback = document.createElement('p');
                    feedback.textContent = "Por favor, preencha email e senha.";
                    feedback.className = "text-red-500 text-sm mt-2 admin-add-feedback";
                    addAdminForm.querySelector('button[type="submit"]').insertAdjacentElement('afterend', feedback);
                    setTimeout(() => feedback.remove(), 3000);
                }
            });
        }
        
        const cartItemsContainer = document.getElementById('cart-items-list'); // Sidebar cart
        const cartTotalValueElement = document.getElementById('cart-total-value'); // Sidebar cart
        const checkoutButtonSidebar = document.getElementById('checkout-button-sidebar'); // Sidebar cart
        const cartEmptyMessage = document.getElementById('cart-empty-message'); // Sidebar cart
        const cartTotalSection = document.getElementById('cart-total-section'); // Sidebar cart

        checkoutButtonSidebar?.addEventListener('click', showCartViewDedicated); // Botão do sidebar leva para a tela de carrinho dedicada


        function handleAddToCart(product, buttonElement) {
            if (isAdminLoggedIn) {
                const feedbackDiv = document.getElementById('admin-action-feedback');
                if (feedbackDiv) feedbackDiv.remove();
                const feedback = document.createElement('p');
                feedback.id = 'admin-action-feedback';
                feedback.textContent = "Funcionalidade de adicionar ao carrinho desabilitada no modo administrador.";
                feedback.className = "fixed bottom-4 right-4 bg-yellow-400 text-yellow-800 p-3 rounded-md shadow-lg z-50";
                document.body.appendChild(feedback);
                setTimeout(() => feedback.remove(), 3000);
                return;
            }
            const existingItem = cart.find(item => item.id === product.id);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            updateCartDisplay(); // Atualiza o sidebar do carrinho
            updateCartViewDedicatedDisplay(); // Atualiza a view dedicada do carrinho, se estiver visível

            if (buttonElement) {
                const originalButtonText = buttonElement.textContent;
                buttonElement.textContent = "Adicionado!";
                buttonElement.disabled = true;
                const feedbackDiv = buttonElement.nextElementSibling; 
                if (feedbackDiv && feedbackDiv.classList.contains('add-to-cart-feedback')) {
                    feedbackDiv.innerHTML = `
                        <p class="text-green-600 font-semibold mb-1">Produto adicionado!</p>
                        <a href="#" class="text-blue-600 hover:underline view-cart-link-feedback text-xs">Ver Carrinho</a> | 
                        <a href="#" class="text-gray-600 hover:underline continue-shopping-link-feedback text-xs">Continuar Comprando</a>
                    `;
                    feedbackDiv.classList.remove('hidden');
                    if(activeFeedbackTimeout) clearTimeout(activeFeedbackTimeout); 
                    const revertButtonAndHide = () => {
                        buttonElement.textContent = originalButtonText;
                        buttonElement.disabled = false;
                        feedbackDiv.classList.add('hidden');
                        feedbackDiv.innerHTML = '';
                    };
                    activeFeedbackTimeout = setTimeout(revertButtonAndHide, 4000);
                    feedbackDiv.querySelector('.view-cart-link-feedback')?.addEventListener('click', (e) => {
                        e.preventDefault(); e.stopPropagation();
                        clearTimeout(activeFeedbackTimeout);
                        revertButtonAndHide();
                        showCartViewDedicated(); // Alterado para mostrar a view dedicada
                    });
                    feedbackDiv.querySelector('.continue-shopping-link-feedback')?.addEventListener('click', (e) => {
                        e.preventDefault(); e.stopPropagation();
                        clearTimeout(activeFeedbackTimeout);
                        revertButtonAndHide();
                    });
                }
            }
        }

        function updateCartDisplay() { // Atualiza o carrinho na sidebar
            if (!cartItemsContainer || !cartTotalValueElement || !checkoutButtonSidebar || !cartEmptyMessage || !cartTotalSection) return;
            cartItemsContainer.innerHTML = '';
            let total = 0;
            if (cart.length === 0) {
                cartEmptyMessage.classList.remove('hidden');
                cartTotalSection.classList.add('hidden');
            } else {
                cartEmptyMessage.classList.add('hidden');
                cartTotalSection.classList.remove('hidden');
                cart.forEach((item) => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'flex justify-between items-center mb-4 pb-2 border-b border-gray-200';
                    itemElement.innerHTML = `
                        <div>
                            <h4 class="font-medium text-gray-600 truncate w-32" title="${item.name}">${item.name}</h4>
                            <p class="text-xs text-gray-500">${item.quantity} x R$ ${item.price.toFixed(2)}</p>
                        </div>
                        <button class="text-red-500 hover:text-red-700 text-sm remove-from-cart-button" data-id="${item.id}">Remover</button>
                    `;
                    cartItemsContainer.appendChild(itemElement);
                    total += item.price * item.quantity;
                });
            }
            cartTotalValueElement.textContent = `R$ ${total.toFixed(2)}`;
            addEventListenersToRemoveFromCartButtons();
        }
        
        function updateCartViewDedicatedDisplay() { // Atualiza a view dedicada do carrinho
            if (!cartItemsListDedicated || !cartTotalValueDedicated || !cartEmptyMessageDedicated || !cartSummaryDedicated) return;
            cartItemsListDedicated.innerHTML = '';
            let total = 0;

            if (cart.length === 0) {
                cartEmptyMessageDedicated.classList.remove('hidden');
                cartSummaryDedicated.classList.add('hidden');
            } else {
                cartEmptyMessageDedicated.classList.add('hidden');
                cartSummaryDedicated.classList.remove('hidden');
                cart.forEach((item) => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'flex justify-between items-center p-4 border-b border-gray-200';
                    itemElement.innerHTML = `
                        <div class="flex items-center">
                            <img src="${item.imageUrl || 'https://placehold.co/60x60/cccccc/969696?text=N/A'}" alt="${item.name}" class="w-16 h-16 object-cover rounded-md mr-4">
                            <div>
                                <h4 class="font-semibold text-gray-700">${item.name}</h4>
                                <p class="text-sm text-gray-500">Quantidade: ${item.quantity}</p>
                                <p class="text-sm text-blue-600">Preço: R$ ${item.price.toFixed(2)}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold text-gray-700">R$ ${(item.price * item.quantity).toFixed(2)}</p>
                            <button class="text-red-500 hover:text-red-700 text-xs mt-1 remove-from-cart-button-dedicated" data-id="${item.id}">Remover</button>
                        </div>
                    `;
                    cartItemsListDedicated.appendChild(itemElement);
                    total += item.price * item.quantity;
                });
            }
            cartTotalValueDedicated.textContent = `R$ ${total.toFixed(2)}`;
            addEventListenersToRemoveFromCartButtonsDedicated();
        }


        function addEventListenersToAddToCartButtons() {
            const addToCartListButtons = document.querySelectorAll('.add-to-cart-button-list');
            addToCartListButtons.forEach(button => {
                const newButton = button.cloneNode(true); 
                button.parentNode.replaceChild(newButton, button);
                newButton.addEventListener('click', (event) => {
                    event.stopPropagation(); 
                    const productCard = event.target.closest('.product-card');
                    const productId = productCard.dataset.id;
                    const product = products.find(p => p.id === productId);
                    if (product) handleAddToCart(product, newButton); 
                });
            });
        }
        
        function addEventListenersToRemoveFromCartButtons() { // Para a sidebar
            const removeButtons = cartItemsContainer.querySelectorAll('.remove-from-cart-button');
            removeButtons.forEach(button => {
                const newButton = button.cloneNode(true);
                button.parentNode.replaceChild(newButton, button);
                newButton.addEventListener('click', (event) => {
                    const productIdToRemove = event.target.dataset.id;
                    cart = cart.filter(item => item.id !== productIdToRemove);
                    updateCartDisplay();
                    updateCartViewDedicatedDisplay(); // Sincroniza a view dedicada
                });
            });
        }

        function addEventListenersToRemoveFromCartButtonsDedicated() { // Para a view dedicada do carrinho
            const removeButtons = cartItemsListDedicated.querySelectorAll('.remove-from-cart-button-dedicated');
            removeButtons.forEach(button => {
                const newButton = button.cloneNode(true);
                button.parentNode.replaceChild(newButton, button);
                newButton.addEventListener('click', (event) => {
                    const productIdToRemove = event.target.dataset.id;
                    cart = cart.filter(item => item.id !== productIdToRemove);
                    updateCartDisplay(); // Sincroniza a sidebar
                    updateCartViewDedicatedDisplay();
                });
            });
        }

        // --- Checkout Logic ---
        copyPixKeyButton?.addEventListener('click', () => {
            pixKeyTextElement.select();
            try {
                document.execCommand('copy'); 
                copyFeedbackElement.textContent = "Chave Pix copiada!";
                copyFeedbackElement.classList.remove('hidden');
                setTimeout(() => {
                    copyFeedbackElement.classList.add('hidden');
                }, 2000);
            } catch (err) {
                console.error('Falha ao copiar a chave Pix: ', err);
                copyFeedbackElement.textContent = "Erro ao copiar.";
                copyFeedbackElement.classList.remove('hidden', 'text-green-600');
                copyFeedbackElement.classList.add('text-red-600');
                 setTimeout(() => {
                    copyFeedbackElement.classList.add('hidden');
                }, 2000);
            }
            window.getSelection().removeAllRanges(); 
        });

        paymentConfirmedButton?.addEventListener('click', () => {
            const paymentFeedback = document.createElement('div');
            paymentFeedback.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-green-100 border border-green-400 text-green-700 px-6 py-4 rounded-lg shadow-xl z-50 text-center';
            paymentFeedback.innerHTML = `
                <h3 class="text-xl font-semibold mb-3">Pagamento Confirmado!</h3>
                <p class="text-sm mb-4">Obrigado por sua compra! Seu pedido será processado em breve.</p>
                <button id="close-payment-feedback" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-md">Fechar</button>
            `;
            document.body.appendChild(paymentFeedback);
            
            document.getElementById('close-payment-feedback').addEventListener('click', () => {
                paymentFeedback.remove();
                cart = []; 
                updateCartDisplay();
                updateCartViewDedicatedDisplay();
                showStoreView(); 
            });
        });


        document.getElementById('register-client-link')?.addEventListener('click', (e) => {
            e.preventDefault(); alert('Funcionalidade "Criar minha conta" a ser implementada.'); closeSideMenu();
        });
        document.getElementById('login-client-link')?.addEventListener('click', (e) => {
            e.preventDefault(); alert('Funcionalidade "Fazer Login (Cliente)" a ser implementada.'); closeSideMenu();
        });
        
        sideMenu.querySelectorAll('nav a[data-order-status]')?.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const status = e.target.dataset.orderStatus;
                showOrdersView(status);
            });
        });

        showStoreView(); 
        updateCartDisplay(); 

        document.getElementById('contact-us-link')?.addEventListener('click', (e) => {
            e.preventDefault(); alert('Funcionalidade "Fale Conosco (SAC)" a ser implementada.');
        });
        
        document.getElementById('store-logo')?.addEventListener('click', (e) => {
            e.preventDefault();
            showStoreView();
        });
        document.querySelector('#store-nav a[href="#"]')?.addEventListener('click', (e) => { 
             if (e.target.textContent === "Início") {
                e.preventDefault();
                showStoreView();
            }
        });

    </script>

</body>
</ht